import cv2

# Importando o video de teste
arquivoVideo = cv2.VideoCapture('carros360p60seg.mp4')
# Importando o xml contendo o classificador de veiculos pré treinado
arquivoClassificador = 'baseVeiculos.xml'

# Criando o classificador que vai reconhecer veiculos
rastrearCarros = cv2.CascadeClassifier(arquivoClassificador)

# Um loop para o programa rodar até os carros pararem
while True:
    # Faz a leitura de quadros no arquivoVideo retornando uma tupla com um valor booleano e um frame do video
    (lidoComSucesso, frame) = arquivoVideo.read()

    # Roda o programa se o video tiver sido lido com sucesso
    if lidoComSucesso:
        # Converte o frame do video para preto e branco na escala preto e branco
        pretoBranco = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
    # Quebra o loop caso o vídeotena acabado
    else:
        break

    # Detectando carros com o detectMultiScale do cv2
    # É criado um lista que armazena outra lista contendo as coordenadas dos carros
    carros = rastrearCarros.detectMultiScale(pretoBranco)

    # Printa no terminal as coordenadas onde há carros dentro da imagem armazenada na lista de carros
    # [x, y, width, height]
    print(carros)

    # Desenhando um retangulo vermelho ao redor dos carros (2:57:00)
    # Para cada x,y,w,h em cada indice de carros
    for (x, y, w, h) in carros:
        cv2.rectangle(frame, (x, y), (x+w, y+h), (0, 0, 225), 2)


    # Criando um display para exibir o video em uma janela
    cv2.imshow('Detector de Veiculos e Pedestres', frame)

    # A função imshow durará só um frame
    # Então com essa função o programa só irá fechar apertando alguma tecla
    cv2.waitKey(1)

print('Código executado com sucesso')